/*!
 * pbjs JavaScript Framework v0.6.0
 * http://saartje87.github.com/pbjs
 *
 * Includes Qwery
 * https://github.com/ded/qwery
 *
 * Copyright 2013 Niek Saarberg
 * Licensed MIT
 *
 * Build date 2013-08-27 14:29
 */
(function(t,e,n){this[t]=n(e)})("PB",this,function(t){"use strict";function e(t,e){return function(){var n,i=this.parent;return this.parent=e,n=t.apply(this,arguments),this.parent=i,n}}function n(t){var e=0;if(t.nodeName||t===m)this[0]=t,e=1;else for(e=0;t.length>e;e++)this[e]=t[e];this.length=e}function i(t){var e=t.__PBID__||(t.__PBID__=f.id());return f.$.cache[e]||(f.$.cache[e]={})}function r(t){var e;return 2===t.length&&(e={},e[t[0]]=t[1]),e||t[0]}function s(t,e){var n,i=t.type;this.originalEvent=t,this.currentTarget=e,this.extend(k);for(n in s.hooks)s.hooks.hasOwnProperty(n)&&s.hooks[n].matches.test(i)&&s.hooks[n].hook(this,t)}function o(t,e,n,r,s){var o,h,u,l=i(t);for(l.element=t,l.eventData||(l.eventData={}),l.eventData[e]||(l.eventData[e]=[]),o=l.eventData[e],u=o.length;u--;)if(o.handler===n)return;h={handler:n,responder:a(t.__PBID__,e,n,r,s)},o.push(h),C||"mouseenter"!==e&&"mouseleave"!==e||(e="mouseenter"===e?"mouseover":"mouseout"),m.addEventListener?t.addEventListener(e,h.responder,!1):t.attachEvent("on"+e,h.responder)}function h(t,e,n){var r,s,o=i(t),h=o.eventData&&o.eventData[e];if(h){for(s=h.length;s--;)if(h[s].handler===n){r=h[s],h.splice(s,1);break}r&&(m.removeEventListener?t.removeEventListener(e,r.responder,!1):t.detachEvent("on"+e,r.responder))}}function a(t,e,n,i,r){return function(o){var h,a,u=f.$.cache[t]&&f.$.cache[t].element;if(u&&(h=new s(o,u),!r||h.matchesSelector(r))){if(u=h.currentTarget,!C&&("mouseleave"===e||"mouseenter"===e)){if(a=h.relatedTarget,u===a||u.contains(a))return;h.type=e}n.call(i||u,h)}}}function u(t){for(var e,n=1,i={duration:.4,effect:"ease"};t.length>n;n++)switch(typeof t[n]){case"function":i.fn=t[n];break;case"number":i.duration=t[n];break;case"string":e=t[n].replace(/([A-Z])/g,"-$1").toLowerCase(),/^linear|ease|ease-in|ease-out|ease-in-out|cubic-bezier\(.*?\)$/.test(e)&&(i.effect=e)}return i}function l(t,e){var n,i,r="",s=f.type(t);if("array"!==s&&"object"!==s)throw new TypeError(s+" given.");if("array"===s||"object"===s)for(n in t)t.hasOwnProperty(n)&&(i=t[n],r+=null!==i&&"object"==typeof i?l(i,e?e+"["+n+"]":n):encodeURIComponent(e?e+("array"===s?"[]":"["+n+"]"):n)+"="+encodeURIComponent(i)+"&");return e?r:r.replace(/&$/,"")}function c(t){var e,n={};return t=-1!==t.indexOf("?")?t.substr(t.indexOf("?")+1):t,t.split("&").forEach(function(t){e=t.split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}),n}var f={},d=t.PB,p=d?d.id():0,g=Array.prototype.slice,v=Object.prototype.toString;f.VERSION="0.6.0",f.id=function(){return++p},f.now=Date.now||function(){return(new Date).getTime()},f.overwrite=function(t,e){var n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},f.extend=function(t,e){var n;for(n in e)e.hasOwnProperty(n)&&void 0===t[n]&&(t[n]=e[n]);return t},f.clone=function(t){var e,n;if(null===t||"object"!=typeof t)return t;e="object"===f.type(t)?{}:[];for(n in t)t.hasOwnProperty(n)&&(e[n]=f.clone(t[n]));return e},f.each=function(t,e,n){var i;if(t&&"function"==typeof e)for(i in t)if(t.hasOwnProperty(i)&&e.call(n,i,t[i],t)===!0)return},f.toArray=function(t){for(var e=0,n=[],i=t.length;i>e;e++)n[e]=t[e];return n},f.type=function(t){var e=v.call(t);return e.substr(8,e.length-9).toLowerCase()},f.log=function(){if("undefined"!=typeof console&&"function"==typeof console.log){var t=f.toArray(arguments);t.unshift("pbjs:"),console.log.apply(console,t)}},f.noConflict=function(){return m.PB===f&&(m.PB=d),f},f.Class=function(t,n){var i,r,s,o,h,a;n?a=t.prototype:(n=t,t=null),i=n.construct,r="function"==typeof i?t&&a.construct?function(){var t=i;return i=function(){var e;return this?(e=this.parent,this.parent=a.construct,t.apply(this,arguments),this.parent=e,void 0):t.apply(this,arguments)},"function"==typeof i?i.apply(this,arguments):void 0}:n.construct:t&&a.construct?function(){a.construct.apply(this,arguments)}:function(){};for(s in n)n.hasOwnProperty(s)&&(h=n[s],o=t?a[s]:!1,"function"==typeof o&&"function"==typeof h&&(h=e(h,o)),r.prototype[s]=h);return t&&f.extend(r.prototype,a),r},f.Observer=f.Class({construct:function(){this.listeners={}},on:function(t,e,n){var i=t.split(" "),r=i.length;if("function"!=typeof e)throw new TypeError("PB.Observer error, fn is not a function");for(;r--;)t=i[r],this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push({fn:e,context:n});return this},off:function(t,e){var n,i=this.listeners[t];if(!t)return this.listeners={},this;if(!i)return this;if(!e)return i.length=0,this;for(n=i.length;n--;)i[n].fn===e&&i.splice(n,1);return i.length||delete this.listeners[t],this},emit:function(t){var e=this.listeners[t],n=g.call(arguments,1),i=0;if(!e)return this;for(;e.length>i;i++)e[i].fn.apply(e[i].context,n);return this}}),f.Queue=f.Class(f.Observer,{construct:function(){var t=this;return this.parent(),this._queue=[],this.next=function(){t.run()},this},queue:function(t,e){return this._queue.push({fn:t,context:e}),this},run:function(){var t=this._queue.shift();if(t)return t.fn.call(t.fn.context,this.next),this},stop:function(){return this._queue.unshift(void 0),this},clear:function(){return this._queue.length=0,this}});var m=t,y=m.document,b=y.documentElement,T=new n(document);f.$=function(t){return t?t instanceof n?t:1===t.nodeType||9===t.nodeType||t===m?new n(t):"string"==typeof t?"#"===t.charAt(0)?(t=y.getElementById(t.substr(1)),t?new n(t):null):"<"===t.charAt(0)&&">"===t.charAt(t.length-1)?f.$.buildFragment(t):T.find(t):null:null},f.$.fn=n.prototype,f.$.cache={},f.$.hooks={},f.$.hook=function(t,e){if("function"!=typeof e)throw new TypeError("fn must be a function");f.$.hooks[t]=e},f.overwrite(f.$.fn,{setAttr:function(t){var e,n=0;for(t=r(arguments);this.length>n;n++)for(e in t)t.hasOwnProperty(e)&&this[n].setAttribute(e,t[e]);return this},getAttr:function(t){return this[0].getAttribute(t)},removeAttr:function(t){for(var e=0;this.length>e;e++)this[e].removeAttribute(t);return this},setValue:function(t){for(var e=0;this.length>e;e++)this[e].value=t;return this},getValue:function(){return this[0].value},setData:function(t){var e,n=0;for(t=r(arguments);this.length>n;n++)e=i(this[n]),e.data=e.data||{},f.overwrite(e.data,t);return this},getData:function(t){var e,n=i(this[0]);return n.data&&(e=n.data[t]),void 0===e&&(e=this[0].getAttribute("data-"+t)),e},removeData:function(t){for(var e,n=0;this.length>n;n++)this[n].removeAttribute("data-"+t),e=this[n].__PBID__,e&&f.$.cache[e]&&delete f.$.cache[e].data[t];return this},serializeForm:function(){for(var t,e,n,i=0,r=0,s={},o=/radio|checkbox/i,h=/file|undefined|reset|button|submit|fieldset/i;this.length>i;i++)if("FORM"===this[i].nodeName){for(t=this[i].elements;t.length>r;r++)e=t[r],n=e.type,!e.name||h.test(n)||o.test(n)&&!e.checked||(s[e.name]=new this.constructor(e).getValue());return s}throw Error("Form not found")}});var $=document.createElement("div"),S="O ms Moz Webkit".split(" "),w="animationName animationDuration transform transition transitionProperty transitionDuration transitionTimingFunction boxSizing backgroundSize boxReflect".split(" "),x={"float":void 0!==$.style.cssFloat?"cssFloat":"styleFloat"},E={zIndex:!0,zoom:!0,fontWeight:!0,opacity:!0};f.each(w,function(t,e){var n;if(e in $.style)return x[e]=e,void 0;for(n=e.charAt(0).toUpperCase()+e.substr(1),t=S.length;t--;)if(S[t]+n in $.style)return x[e]=S[t]+n,void 0}),$=null,f.overwrite(f.$.fn,{setStyle:function(t){var e,n,i=0;for(t=r(arguments);this.length>i;i++)for(e in t)if(t.hasOwnProperty(e))if(n=t[e],f.$.hooks["setStyle."+e])f.$.hooks["setStyle."+e](this[i],n);else{"number"!=typeof n||E[e]||(n+="px");try{this[i].style[x[e]||e]=n}catch(s){}}return this},getStyle:function(t,e){var n,i=x[t]||t;return n=this[0].style[i],(e||!n||"auto"===n)&&(n=m.getComputedStyle(this[0],null)[i],"auto"===n&&(n=0)),n="opacity"===t?n?parseFloat(n):1:/^-?[\d.]+px$/i.test(n)?parseInt(n,10):n,f.$.hooks["getStyle."+t]?f.$.hooks["getStyle."+t](this[0],n,i):n}}),f.overwrite(f.$.fn,{append:function(t){var e=0;for(t=f.$(t);t.length>e;e++)this[0].appendChild(t[e]);return this},appendTo:function(t){var e=0;for(t=f.$(t);this.length>e;e++)t[0].appendChild(this[e]);return this},prepend:function(t){var e=0,n=this[0].firstElementChild||this[0].firstChild;for(t=f.$(t);t.length>e;e++)n?this[0].insertBefore(t[e],n):this[0].appendChild(t[e]);return this},prependTo:function(t){var e,n=0;for(t=f.$(t),e=t[0].firstElementChild||t[0].firstChild;this.length>n;n++)e?t[0].insertBefore(this[n],e):t[0].appendChild(this[n]);return this},insertBefore:function(t){var e=0;for(t=f.$(t);this.length>e;e++)t[0].parentNode.insertBefore(this[e],t[0]);return this},insertAfter:function(t){var e,n=0;for(t=f.$(t),e=t[0].nextElementSibling||t[0].nextSibling;this.length>n;n++)e?t[0].parentNode.insertBefore(this[n],e):t[0].appendChild(this[n]);return this},replace:function(t){return t=f.$(t),this.insertBefore(t),t.remove(),this},remove:function(){for(var t=0;this.length>t;t++)delete f.$.cache[this[t].__PBID__],this[t].parentNode&&this[t].parentNode.removeChild(this[t]),delete this[t];return this.length=0,null},empty:function(){return this.setHtml("")},clone:function(t){for(var e,n=[],i=0;this.length>i;i++)if(n[i]=this[i].cloneNode(t),n[i].removeAttribute("id"),n[i].removeAttribute("__PBID__"),t)for(e=f.$(n[i]).find("*");length>i;i++)e[i].removeAttribute("id"),e[i].removeAttribute("__PBID__");return new this.constructor(n)},setHtml:function(t){for(var e=0;this.length>e;e++)try{this[e].innerHTML=t}catch(n){f.$(this[e]).children().remove(),/^<tbody/i.test(t)?f.$("<table>"+t+"</table>").firstChild().appendTo(this[e]):/^<tr/i.test(t)?f.$("<table><tbody>"+t+"<tbody></table>").firstChild().children().appendTo(this[e]):/^<td/i.test(t)?f.$("<table><tbody><tr>"+t+"</tr><tbody></table>").firstChild().firstChild().children().appendTo(this[e]):f.$(t).appendTo(this[e])}return this},getHtml:function(){return this[0].innerHTML},setText:function(t){for(var e=0;this.length>e;e++)this[e].textContent=t;return this},getText:function(){return this[0].textContent||this[0].innerText}}),f.overwrite(f.$.fn,{width:function(){return this[0]===m?m.innerWidth||b.clientWidth:this[0]===y?Math.max(b.clientWidth,b.offsetWidth,b.scrollWidth):this.getStyle("width",!0)},innerWidth:function(){return this.width()+this.getStyle("paddingLeft",!0)+this.getStyle("paddingRight",!0)},outerWidth:function(t){var e=this.innerWidth()+this.getStyle("borderLeftWidth",!0)+this.getStyle("borderRightWidth",!0);return t&&(e+=this.getStyle("marginLeft",!0)+this.getStyle("marginRight",!0)),e},scrollWidth:function(){return this[0].scrollWidth},height:function(){return this[0]===m?m.innerHeight||b.clientHeight:this[0]===y?Math.max(b.clientHeight,b.offsetHeight,b.scrollHeight):this.getStyle("height",!0)},innerHeight:function(){return this.height()+this.getStyle("paddingTop",!0)+this.getStyle("paddingBottom",!0)},outerHeight:function(t){var e=this.innerHeight()+this.getStyle("borderTopWidth",!0)+this.getStyle("borderBottomWidth",!0);return t&&(e+=this.getStyle("marginTop",!0)+this.getStyle("marginBottom",!0)),e},scrollHeight:function(){return this[0].scrollHeight},setScroll:function(t){for(var e=0;this.length>e;e++)void 0!==t.top&&(this[e].scrollTop=t.top),void 0!==t.left&&(this[e].scrollLeft=t.left);return this},getScroll:function(){return{top:1===this[0].nodeType?this[0].scrollTop:Math.max(b.scrollTop,y.body.scrollTop),left:1===this[0].nodeType?this[0].scrollLeft:Math.max(b.scrollLeft,y.body.scrollLeft)}},position:function(){var t=this[0].getBoundingClientRect();return{top:t.top+(m.scrollY||m.pageYOffset),left:t.left+(m.scrollX||m.pageXOffset)}},offset:function(){for(var t=this[0],e={top:0,left:0};t&&(e.top+=t.offsetTop,e.left+=t.offsetLeft,t=t.offsetParent,t&&"static"===f.$(t).getStyle("position")););return e},hasClass:function(t){return(" "+this[0].className+" ").indexOf(" "+t+" ")>=0},addClass:function(t){for(var e,n,i=0,r=t.split(" ");this.length>i;i++)for(e=" "+this[i].className+" ",n=0;r.length>n;n++)e.indexOf(" "+r[n]+" ")>=0||(this[i].className+=(this[i].className?" ":"")+r[n]);return this},removeClass:function(t){for(var e,n,i=0,r=t.split(" "),s=r.length;this.length>i;i++){for(e=" "+this[i].className+" ",n=0;s>n;n++)e.indexOf(" "+r[n]+" ")>=0&&(e=e.replace(" "+r[n]+" "," "));e=e.replace(/^\s|\s$/g,""),e?this[i].className=e:this[i].removeAttribute("class")}return this},show:function(){for(var t,e=0;this.length>e;e++)t=this[e].style,"none"===t.display&&(t.display=i(this[e])["css-display"]||"block");return this},hide:function(){for(var t,e=0;this.length>e;e++)t=this[e].style,"none"!==t.display&&(i(this[e])["css-display"]=f.$(this[e]).getStyle("display"),t.display="none");return this},isVisible:function(){var t=f.$(this[0]);return"none"!==t.getStyle("display")&&t.getStyle("opacity")>0}}),f.overwrite(f.$.fn,{parent:function(){return f.$(this[0].parentNode)},children:function(){var t=this[0].firstElementChild||this[0].firstChild,e=0,n=[];if(!t)return null;do 1===t.nodeType&&(n[e++]=t);while(t=t.nextSibling);return n.length?new this.constructor(n):null},childAt:function(t){var e=this.children();return e&&e[t]?f.$(e[t]):null},firstChild:function(){return f.$(this[0].firstElementChild||this[0].firstChild)},lastChild:function(){return f.$(this[0].lastElementChild||this[0].lastChild)},first:function(){return f.$(this[0])},last:function(){return f.$(this[this.length-1])},next:function(){return f.$(this[0].nextElementSibling||this[0].nextSibling)},prev:function(){return f.$(this[0].previousElementSibling||this[0].previousSibling)},closest:function(t,e){var n=this[0];e=e||50;do{if(f.$.selector.matches(n,t))return f.$(n);if(!--e)break}while(n=n.parentNode);return null},indexOf:function(t){var e=0;if(t=f.$(t),!t)return-1;for(;this.length>e;e++)if(this[e]===t[0])return e;return-1},contains:function(t){var e=this[0];return t=f.$(t),e&&t?e.contains?e.contains(t[0]):!!(16&e.compareDocumentPosition(t[0])):!1},find:function(t){for(var e,n,i,r,s,o=0;this.length>o;o++)if(0===o)s=f.$.selector.find(t,this[o]);else for(r=f.$.selector.find(t,this[o]),e=0,n=s.length,i=r.length;i>e;e++)-1===s.indexOf(r[e])&&(s[n++]=r[e]);return s.length?new this.constructor(s):null},matches:function(t){for(var e=0;this.length>e;e++)if(!f.$.selector.matches(this[e],t))return!1;return!0}});var C="onmouseenter"in b&&"onmouseleave"in b,A=/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,k="type target defaultPrevented bubbles".split(" "),_="altKey ctrlKey metaKey shiftKey which pageX pageY".split(" ");s.prototype={extend:function(t){for(var e=0,n=t.length;n>e;e++)this[t[e]]=this.originalEvent[t[e]]},preventDefault:function(){this.defaultPrevented=!0,this.originalEvent.preventDefault()},stopPropagation:function(){this.originalEvent.stopPropagation()},stop:function(){this.preventDefault(),this.stopPropagation()},matchesSelector:function(t){var e=this.target;do{if(f.$.selector.matches(e,t))return this.currentTarget=e,!0;if(e===this.currentTarget)return!1}while(e=e.parentNode);return!1}},s.hooks={mouse:{matches:/(!?mouse|click|drag|focusin|focusout)/,hook:function(t,e){t.extend(_),e.relatedTarget&&(t.relatedTarget=e.relatedTarget)}},mousewheel:{matches:/^(?:DOMMouseScroll|mousewheel|wheel)$/,hook:function(t,e){t.wheelDelta=e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3}}},f.$.Event=s,f.overwrite(f.$.fn,{on:function(t,e,n,i){var r,s=t.split(" "),h=s.length,a=0;if("function"==typeof e&&(i=n,n=e,e=null),"function"!=typeof n)throw new TypeError;for(;this.length>a;a++)for(r=0;h>r;r++)o(this[a],s[r],n,i,e);return this},off:function(t,e){for(var r,s,o=0;this.length>o;o++)if(r=i(this[o]).eventData,r||!t||r[t])if(t)if(e)h(this[o],t,e);else{for(s=0;r[t].length>s;s++)h(this[o],t,r[t][s].handler);delete r[name]}else for(s in r)r.hasOwnProperty(s)&&new n(this[o]).off(s);return this},emit:function(t){for(var e,n=0,i=A.test(t);this.length>n;n++)i||"input"===this[n].nodeName&&"click"===t?this[n][t]():y.createEvent?(e=y.createEvent("HTMLEvents"),e.initEvent(t,!0,!0,m,1),this[n].dispatchEvent(e)):this[n].fireEvent("on"+t,y.createEventObject());return this}}),f.$.buildFragment=function(t){var e,n=y.createElement("div");return n.innerHTML=t,e=f.$(n).children(),n=null,e},f.overwrite(f.$.fn,{each:function(t){for(var e=g.call(arguments,1),n=0;this.length>n;n++)t.apply(this[n],e);return this},filter:function(t){for(var e=[],n=0,i="string"==typeof t;this.length>n;n++)i?f.$.selector.matches(this[n],t)&&e.push(this[n]):t(this[n])===!0&&e.push(this[n]);return new this.constructor(e)}}),f.Animation=function(t){this.running=!1,this.duration=1e3*t.duration,this.onTick=t.onTick||function(){},this.timerFunction=f.Animation.effects[t.effect]||f.Animation.effects.ease,this.data=t.data},f.overwrite(f.Animation.prototype,{start:function(){this.startAt=+new Date,this.endAt=this.startAt+this.duration,this.running=!0,this.tick()},stop:function(){clearTimeout(this.timer),this.running=!1},tick:function(){var t=+new Date,e=this,n=this.timerFunction(1-(this.endAt-t)/this.duration);return t>=this.endAt?(this.onTick(1,this.data,this),this.stop(),void 0):(this.onTick(n,this.data,this),this.timer=setTimeout(function(){e.tick()},1e3/60),void 0)}}),f.Animation.effects={linear:function(t){return t},ease:function(t){return t},"ease-in":function(t){return t*t},"ease-out":function(t){return-1*t*(t-2)},"ease-in-out":function(t){return t},bounce:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}},f.Queue=f.Class({construct:function(){this.stack=[],this.length=0,this.state=f.Queue.STATE_IDLE,this._next=this.next.bind(this)},add:function(t,e){return this.length++,this.stack.unshift(t.bind(e||t,this._next)),this},run:function(){var t,e=this.stack;return this.state!==f.Queue.STATE_INPROGRESS&&e.length?(this.state=f.Queue.STATE_INPROGRESS,t=this.stack.pop(),t(),this):this},next:function(){this.state=f.Queue.STATE_IDLE,this.run()},empty:function(){this.stack.length=0,this.state=f.Queue.STATE_IDLE}}),f.Queue.STATE_IDLE=0,f.Queue.STATE_INPROGRESS=1,f.$.fn.transition=function(t){var e=u(arguments);return e.properties=t,f.$.hooks.transition.call(this,e),this},f.$.hook("transition",function(t){return this.each(function(){var e=f.$(this),n=e.getData("pbjs-fx-queue"),i=t.properties;n||(n=new f.Queue,e.setData("pbjs-fx-queue",n)),n.add(function(n,r){var r={},s={transition:"all "+t.duration+"s "+t.effect+" 0s"};r.end=i,r.fn=t.fn,f.each(i,function(t){s[t]=e.getStyle(t,!0)}),e.setStyle(s),this.offsetHeight,e.setStyle(i),r.timer=setTimeout(function(){e[0].parentNode&&(r.running=!1,e.setStyle({transition:""}),r.fn&&r.fn(e),n())},1e3*t.duration+50)}),n.run()})}),x.transition||f.$.hook("transition",function(t,e){var n=0;if(this.setStyle(t),e.fn)for(;this.length>n;n++)e.fn(f.$(this[n]));return this}),f.$.fn.stop=function(t){return this.each(function(){var e=f.$(this),n=e.getData("morph");n&&n.running&&(t=void 0===t?!0:!!t,n.running=!1,clearTimeout(n.timer),n.end.transition="none 0s ease 0s",t||f.each(n.end,function(t){n.end[t]=e.getStyle(t,!0)}),e.setStyle(n.end),t&&n.fn&&n.fn(this))})},f.$.fn.morph=f.$.fn.transition;var D=b.matchesSelector||b.mozMatchesSelector||b.webkitMatchesSelector||b.oMatchesSelector||b.msMatchesSelector;f.$.selector={find:function(t,e){return f.toArray(e.querySelectorAll(t))},matches:function(t,e){return 1!==t.nodeType?!1:D.call(t,e)}},function(t){function e(){var e;for(s=!0;e=o.shift();)e(t)}function n(e){s?e(t):o.push(e)}var i,r=m.document,s="complete"===r.readyState,o=[];r.addEventListener?r.addEventListener("DOMContentLoaded",i=function(){r.removeEventListener("DOMContentLoaded",i),e()}):r.attachEvent("onreadystatechange",i=function(){"complete"===r.readyState&&(r.detachEvent("onreadystatechange",i),e())}),t.ready=n}(f);var O="XMLHttpRequest"in t;return f.Request=f.Class(f.Observer,{xhr:null,construct:function(t){this.options=f.clone(f.Request.defaults),this.parent(),f.overwrite(this.options,t)},send:function(){var t=this.options,e=t.async,n=this.getTransport(),i=t.url,r=t.method.toUpperCase(),s="object"===f.type(t.data)?f.Request.buildQueryString(t.data):t.data;return clearTimeout(this.abortTimer),!s||"GET"!==r&&"PUT"!==r||(i+=(-1===i.indexOf("?")?"?":"&")+s,s=null),e&&(n.onreadystatechange=this.onreadystatechange.bind(this)),n.open(r,i,e),("POST"===r||"PUT"===r)&&n.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset="+this.charset),f.each(t.headers,function(t,e){n.setRequestHeader(t,e)}),this.emit("send",n,0),n.send(s||null),t.timeout>0&&(this.abortTimer=setTimeout(this.abort.bind(this),1e3*t.timeout)),e||this.onreadystatechange(),this},abort:function(){return this.xhr.onreadystatechange=null,this.xhr.abort(),this.emit("abort"),this},set:function(t,e){return"header"===t.substr(0,6)?f.overwrite(this.options.headers,e):this.options[t]=e,this},getTransport:function(){return this.xhr&&O?this.xhr:(this.xhr&&this.xhr.abort(),this.xhr=O?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.xhr)},onreadystatechange:function(){var t,e=this.xhr,n=this.options;if(4===e.readyState){switch(clearTimeout(this.abortTimer),e.responseJSON=null,e.status){case 200:case 201:case 204:case 304:if(t="success",n.json||e.getResponseHeader("Content-type").indexOf("application/json")>=0)try{e.responseJSON=JSON.parse(e.responseText)}catch(i){}break;default:t="error"}this.xhr.onreadystatechange=null,this.emit(t,e,e.status),this.emit("end",e,e.status)}}}),f.Request.defaults={url:"",method:"GET",async:!0,json:!1,xml:!1,data:null,auth:null,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},encoding:"UTF-8",timeout:0,crossdomain:!1},f.overwrite(f.Request,{buildQueryString:l,parseQueryString:c}),f});