/*!
 * pbjs JavaScript Framework v0.6.0
 * http://saartje87.github.com/pbjs
 *
 * Includes Qwery
 * https://github.com/ded/qwery
 *
 * Copyright 2013 Niek Saarberg
 * Licensed MIT
 *
 * Build date 2013-03-08 00:24
 */
(function(e,t,n){this[e]=n(t)})("PB",this,function(e){"use strict";function u(e,t){return function(){var n=this.parent,r;return this.parent=t,r=e.apply(this,arguments),this.parent=n,r}}function p(e){var n=e.__PBID__||(e.__PBID__=t.id());return t.$.cache[n]||(t.$.cache[n]={})}function b(e){var t;return e.length===2&&(t={},t[e[0]]=e[1]),t||e[0]}function w(e){var n={duration:.4,effect:"ease"};for(var r=1;r<e.length;r++)switch(typeof e[r]){case"function":n.fn=e[r];break;case"number":n.duration=e[r];break;case"string":n.effect=t.String.decamelize(e[r])}return n}function E(e,n){var r="",i,s,o=t.type(e);if(o!=="array"&&o!=="object")throw new TypeError(o+" given.");if(o==="array"||o==="object")for(i in e)e.hasOwnProperty(i)&&(s=e[i],s!==null&&typeof s=="object"?r+=E(s,n?n+"["+i+"]":i):r+=encodeURIComponent(n?n+(o==="array"?"[]":"["+i+"]"):i)+"="+encodeURIComponent(s)+"&");return n?r:r.replace(/&$/,"")}function S(e){var t={},n;return e=e.indexOf("?")!==-1?e.substr(e.indexOf("?")+1):e,e.split("&").forEach(function(e){n=e.split("="),t[decodeURIComponent(n[0])]=decodeURIComponent(n[1])}),t}var t={},n=e.PB,r=n?n.id():0,i=Array.prototype.slice,s=Object.prototype.toString,o;t.VERSION="0.6.0",t.id=function(){return++r},t.overwrite=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},t.extend=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&e[n]===o&&(e[n]=t[n]);return e},t.clone=function(e){var n,r;if(e===null||typeof e!="object")return e;n=t.type(e)==="object"?{}:[];for(r in e)e.hasOwnProperty(r)&&(n[r]=t.clone(e[r]));return n},t.each=function(e,t,n){var r;if(!e||typeof t!="function")return;for(r in e)if(e.hasOwnProperty(r)&&t.call(n,r,e[r],e)===!0)return},t.toArray=function(e){if(s.call(e)==="[object Object]"&&e.length){var t=[],n=e.length,r=0;for(;r<n;r++)t[r]=e[r];return t}return i.call(e)},t.type=function(e){var t=s.call(e);return t.substr(8,t.length-9).toLowerCase()},t.noConflict=function(){return f.PB===t&&(f.PB=n),t},t.Class=function(e,n){var r,i,s,o,a,f;n?f=e.prototype:(n=e,e=null),r=n.construct;if(typeof r=="function")if(e&&f.construct){var l;i=function(){var e=r;r=function(){var t=this.parent;this.parent=f.construct,e.apply(this,arguments),this.parent=t},typeof r=="function"&&r.apply(this,arguments)}}else i=n.construct;else e&&f.construct?i=function(){f.construct.apply(this,arguments)}:i=function(){};for(s in n)n.hasOwnProperty(s)&&(a=n[s],o=e?f[s]:!1,typeof o=="function"&&typeof a=="function"&&(a=u(a,o)),i.prototype[s]=a);return e&&t.extend(i.prototype,f),i},t.Observer=t.Class({construct:function(){this.listeners={}},on:function(e,t,n){var r=e.split(" "),i=r.length;if(typeof t!="function")throw new TypeError("PB.Observer error, fn is not a function");while(i--)e=r[i],this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({fn:t,context:n});return this},off:function(e,t){var n=this.listeners[e],r;if(!e)return this.listeners={},this;if(!n)return this;if(!t)return n.length=0,this;r=n.length;while(r--)n[r].fn===t&&n.splice(r,1);return n.length||delete this.listeners[e],this},emit:function(e){var t=this.listeners[e],n=i.call(arguments,1),r=0;if(!t)return this;for(;r<t.length;r++)t[r].fn.apply(t[r].context,n);return this}});var a,f=e,l=f.document,c=l.documentElement,h=l.body;t.$=function(e){if(!e)return null;if(e.nodeType)return new a(e);if(typeof e=="string"){if(e.charAt(0)==="#")return e=l.getElementById(e.substr(1)),e?new a(e):null;e.charAt(0)==="<"&&e.charAt(e.length-1)===">"}return null},t.$$=function(e){return(new a(document)).find(e)},t.$.cache={},a=function(e){var t=0;if(e.length)for(t=0;t<e.length;t++)this[t]=e[t];else this[0]=e;this.length=t||1},a.prototype.constructor=a,t.$.fn=a.prototype,t.$.hooks={},t.$.hook=function(e,n){if(typeof n!="function")throw new TypeError("fn must be a function");t.$.hooks[e]=n};var d=document.createElement("div"),v="O ms Moz Webkit".split(" "),m="animationName transform transition transitionProperty transitionDuration transitionTimingFunction boxSizing backgroundSize boxReflect".split(" "),g={"float":d.style.cssFloat!==o?"cssFloat":"styleFloat"},y={zIndex:!0,zoom:!0,fontWeight:!0,opacity:!0};return t.each(m,function(e,t){var n;if(t in d.style)return g[t]=t;n=t.charAt(0).toUpperCase()+t.substr(1),e=v.length;while(e--)if(v[e]+n in d.style)return g[t]=v[e]+n}),d=null,t.overwrite(a.prototype,{setStyle:function(e){var n=0,r,i;e=b(arguments);for(;n<this.length;n++)for(r in e){i=e[r];if(t.$.hooks["setStyle."+r])t.$.hooks["setStyle."+r](this[n],i);else{typeof i=="number"&&!y[r]&&(i+="px");try{this[n].style[g[r]||r]=i}catch(s){}}}return this},getStyle:function(e,t){var n;e=g[e]||e,n=this[0].style[e];if(t||!n||n==="auto")n=l.defaultView.getComputedStyle(this[0],null)[e];return e==="opacity"?n?parseFloat(n):1:/^-?[\d.]+px$/i.test(n)?parseInt(n,10):n}}),a.prototype.morph=g.transition?function(e){var n=w(arguments);return this.each(function(){var r=t.$(this),i=r.getData("morph")||{},s={transition:"all "+n.duration+"s "+n.effect+" 0s"};i.running&&r.stop(!1),i.end=e,i.fn=n.fn,i.running=!0,t.each(e,function(e){s[e]=r.getStyle(e,!0)}),r.setStyle(s),l.defaultView.getComputedStyle(this),r.setStyle(e),i.timer=setTimeout(function(){if(!r[0])return;i.running=!1,r.setStyle({transition:""}),i.fn&&i.fn(r)},n.duration*1e3+60),r.setData("morph",i)})}:function(e){var n=w(arguments),r=0;this.setStyle(e);if(n.fn)for(;r<this.length;r++)n.fn(t.$(this[r]))},a.prototype.stop=function(e){return this.each(function(){var n=t.$(this),r=n.getData("morph");if(!r||!r.running)return;e=e===o?!0:!!e,r.running=!1,clearTimeout(r.timer),r.end.transition="",e?t.each(r.end,function(e){n.setStyle(e,"").getStyle(e,!0)}):t.each(r.end,function(e){r.end[e]=n.getStyle(e,!0)}),n.setStyle(r.end),e&&r.fn&&r.fn(this)})},t.overwrite(a.prototype,{each:function(e){var t=i.call(arguments,1);for(var n=0;n<this.length;n++)e.apply(this[n],t);return this},hasClass:function(e){return(" "+this.context.className+" ").indexOf(" "+e+" ")>=0},addClass:function(e){var t=0,n=e.split(" "),r,i;for(;t<this.length;t++){r=" "+this[t].className+" ";for(i=0;i<n.length;i++){if(r.indexOf(" "+n[i]+" ")>=0)continue;this[t].className+=(this[t].className?" ":"")+n[i]}}return this},removeClass:function(e){var t=0,n=e.split(" "),r=n.length,i,s;for(;t<this.length;t++){i=" "+this[t].className+" ";for(s=0;s<r;s++)i.indexOf(" "+n[s]+" ")>=0&&(i=i.replace(" "+n[s]+" "," "));i=i.replace(/^\s|\s$/g,""),i?this[t].className=i:this[t].removeAttribute("class")}return this},setData:function(e){var n=0,r;e=b(arguments);for(;n<this.length;n++)r=p(this[n]),r.data=r.data||{},t.overwrite(r.data,e);return this},getData:function(e){var t=p(this[0]),n;return t.data&&(n=t.data[e]),n===o&&(n=this[0].getAttribute("data-"+e)),n},removeData:function(e){var n=0,r,i;for(;n<this.length;n++){this[n].removeAttribute("data-"+e),i=this[n].__PBID__,r=t.$.cache[i];if(!r||!r.data)continue;delete r.data[e]}return this},setAttr:function(e){var t=0,n;e=b(arguments);for(;t<this.length;t++)for(n in e)this[t].setAttribute(n,e[n]);return this},getAttr:function(e){return this[0].getAttribute(e)},removeAttr:function(e){var t=0;for(;t<this.length;t++)this[t].removeAttribute(e);return this},setValue:function(e){var t=0;for(;t<this.length;t++)this[t].value=e;return this},getValue:function(){return this[0].value},show:function(){var e,t=0;for(;t<this.length;t++)e=this[t].style,e.display==="none"&&(e.display=p(this[t])["css-display"]||"block");return this},hide:function(){var e,n=0;for(;n<this.length;n++)e=this[n].style,e.display!=="none"&&(p(this[n])["css-display"]=t.$(this[n]).getStyle("display"),e.display="none");return this},isVisible:function(){var e=t.$(this[0]);return e.getStyle("display")!=="none"&&e.getStyle("opacity")>0}}),t.overwrite(a.prototype,{parent:function(){return new this.constructor(this[0].parentNode)},children:function(){var e=this[0].firstChild,t=0,n=[];do e.nodeType===1&&(n[t++]=e);while(e=e.nextSibling);return new this.constructor(n)},firstChild:function(){var e=this[0].firstElementChild||this[0].firstChild;while(e&&e.nodeType!==1)e=e.nextSibling;return t.$(e)},lastChild:function(){var e=this[0].lastElementChild||this[0].lastChild;while(e&&e.nodeType!==1)e=e.previousSibling;return t.$(e)},first:function(){return new this.constructor(this[0])},last:function(){return new this.constructor(this[this.length-1])},next:function(){},prev:function(){},closest:function(){},find:function(e){var t=0,n=this.length,r,i,s,o,u;for(;t<n;t++)if(t===0)u=qwery(e,this[t]);else{o=qwery(e,this[t]);for(r=0,i=u.length,s=o.length;r<s;r++)u.indexOf(o[r])===-1&&(u[i++]=o[r])}return new this.constructor(u)}}),t.Request=t.Class(t.Observer,{stateTypes:"unsent opened headers loading end".split(" "),transport:null,construct:function(e){this.options=t.clone(t.Request.defaults),this.parent(),t.overwrite(this.options,e)},send:function(){var e=this.options,n=e.async,r=this.getTransport(),i=e.url,s=e.method.toUpperCase(),o=t.type(e.data)==="object"?t.Request.buildQueryString(e.data):e.data;return o&&(s==="GET"||s==="PUT")&&(i+=(i.indexOf("?")===-1?"?":"&")+o,o=null),n&&(r.onreadystatechange=this.onreadystatechange.bind(this)),r.open(s,i,n),(s==="POST"||s==="PUT")&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset="+this.charset),t.each(e.headers,function(e,t){r.setRequestHeader(e,t)}),this.emit("send",this.transport,0),r.send(o||null),n||this.onreadystatechange(),this},abort:function(){return this.transport.abort(),this.emit("abort"),this},set:function(e,n){return e.substr(0,6)==="header"&&t.overwrite(this.options.headers,n),this.options[e]=n,this},getTransport:function(){if(this.transport&&f.XMLHttpRequest)return this.transport;if(f.XMLHttpRequest)return this.transport=new XMLHttpRequest;this.transport&&this.transport.abort();try{return this.transport=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){}throw new Error("Browser doesn`t support XMLHttpRequest")},onreadystatechange:function(){var e=this.transport,t=this.options,n="error";if(e.readyState===4){e.responseJSON=null;if(e.status>=200&&e.status<300){if(t.json||e.getResponseHeader("Content-type").indexOf("application/json")>=0)try{e.responseJSON=JSON.parse(e.responseText)}catch(r){}n="success"}this.emit(n,e,e.status,n),this.transport.onreadystatechange=null}n=this.stateTypes[e.readyState],this.emit(n,e,e.readyState===4?e.status:0,n)}}),t.Request.defaults={url:"",method:"GET",async:!0,json:!1,xml:!1,data:null,auth:null,headers:{"X-Requested-With":"PBJS-"+t.VERSION,Accept:"text/javascript, text/html, application/xml, text/xml, */*"},encoding:"UTF-8",timeout:0},t.overwrite(t.Request,{buildQueryString:E,parseQueryString:S}),t});